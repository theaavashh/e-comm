generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  username      String         @unique
  password      String
  firstName     String?
  lastName      String?
  phone         String?
  avatar        String?
  role          UserRole       @default(CUSTOMER)
  isActive      Boolean        @default(true)
  emailVerified Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  addresses     Address[]
  cartItems     CartItem[]
  orders        Order[]
  reviews       Review[]
  wishlist      WishlistItem[]

  @@map("users")
}

model Address {
  id             String      @id @default(cuid())
  userId         String
  type           AddressType @default(SHIPPING)
  street         String
  city           String
  state          String
  zipCode        String
  country        String
  isDefault      Boolean     @default(false)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  billingOrders  Order[]     @relation("OrderBillingAddress")
  shippingOrders Order[]     @relation("OrderShippingAddress")

  @@map("addresses")
}

model Category {
  id           String     @id @default(cuid())
  name         String
  slug         String     @unique
  description  String?
  image        String?
  isActive     Boolean    @default(true)
  parentId     String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  internalLink String?
  parent       Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children     Category[] @relation("CategoryHierarchy")
  products     Product[]
  subProducts  Product[]  @relation("ProductSubCategory")

  @@map("categories")
}

model Brand {
  id        String    @id @default(cuid())
  name      String    @unique
  logo      String?
  website   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]

  @@map("brands")
}

model Product {
  id                String                 @id @default(cuid())
  name              String
  slug              String                 @unique
  description       String?
  price             Decimal                @db.Decimal(10, 2)
  comparePrice      Decimal?               @db.Decimal(10, 2)
  costPrice         Decimal?               @db.Decimal(10, 2)
  margin            Decimal?               @db.Decimal(5, 2)
  sku               String?                @unique
  barcode           String?
  upc               String?
  ean               String?
  isbn              String?
  trackQuantity     Boolean                @default(true)
  quantity          Int                    @default(0)
  lowStockThreshold Int                    @default(5)
  allowBackorder    Boolean                @default(false)
  manageStock       Boolean                @default(true)
  weight            Decimal?               @db.Decimal(8, 2)
  weightUnit        String?                @default("kg")
  dimensions        Json?
  images            String[]
  videos            String[]
  thumbnail         String?
  seoTitle          String?
  seoDescription    String?
  seoKeywords       String[]
  metaTags          Json?
  isActive          Boolean                @default(true)
  isDigital         Boolean                @default(false)
  isFeatured        Boolean                @default(false)
  isNew             Boolean                @default(false)
  isOnSale          Boolean                @default(false)
  isBestSeller      Boolean                @default(false)
  visibility        ProductVisibility      @default(VISIBLE)
  publishedAt       DateTime?
  categoryId        String
  tags              String[]
  requiresShipping  Boolean                @default(true)
  shippingClass     String?
  freeShipping      Boolean                @default(false)
  taxable           Boolean                @default(true)
  taxClass          String?
  customFields      Json?
  notes             String?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  brandId           String?
  subCategoryId     String?
  canonicalUrl      String?
  focusKeyword      String?
  ogImage           String?
  cartItems         CartItem[]
  orderItems        OrderItem[]
  attributes        ProductAttribute[]
  currencyPrices    ProductCurrencyPrice[]
  pricingTiers      ProductPricingTier[]
  variants          ProductVariant[]
  brand             Brand?                 @relation(fields: [brandId], references: [id])
  category          Category               @relation(fields: [categoryId], references: [id])
  subCategory       Category?              @relation("ProductSubCategory", fields: [subCategoryId], references: [id])
  reviews           Review[]
  wishlist          WishlistItem[]

  @@map("products")
}

model ProductCurrencyPrice {
  id              String   @id @default(cuid())
  productId       String
  country         String
  currency        String   @default("NPR")
  symbol          String   @default("NPR")
  price           Decimal  @db.Decimal(10, 2)
  comparePrice    Decimal? @db.Decimal(10, 2)
  minDeliveryDays Int
  maxDeliveryDays Int
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, country, currency])
  @@map("product_currency_prices")
}

model ProductVariant {
  id           String   @id @default(cuid())
  productId    String
  name         String
  value        String
  price        Decimal? @db.Decimal(10, 2)
  comparePrice Decimal? @db.Decimal(10, 2)
  sku          String?  @unique
  barcode      String?
  quantity     Int      @default(0)
  weight       Decimal? @db.Decimal(8, 2)
  image        String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  dimensions   Json?
  height       Decimal? @db.Decimal(8, 2)
  length       Decimal? @db.Decimal(8, 2)
  width        Decimal? @db.Decimal(8, 2)
  asin         String?  @unique
  product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_variants")
}

model ProductPricingTier {
  id          String   @id @default(cuid())
  productId   String
  minQuantity Int
  maxQuantity Int?
  price       Decimal  @db.Decimal(10, 2)
  discount    Decimal? @db.Decimal(5, 2)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_pricing_tiers")
}

model ProductAttribute {
  id           String        @id @default(cuid())
  productId    String
  name         String
  value        String
  type         AttributeType @default(TEXT)
  isRequired   Boolean       @default(false)
  isFilterable Boolean       @default(true)
  sortOrder    Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  product      Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_attributes")
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("cart_items")
}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlist_items")
}

model Order {
  id                String         @id @default(cuid())
  orderNumber       String         @unique
  userId            String
  status            OrderStatus    @default(PENDING)
  paymentStatus     PaymentStatus  @default(PENDING)
  shippingStatus    ShippingStatus @default(PENDING)
  subtotal          Decimal        @db.Decimal(10, 2)
  taxAmount         Decimal        @db.Decimal(10, 2)
  shippingAmount    Decimal        @db.Decimal(10, 2)
  discountAmount    Decimal        @db.Decimal(10, 2)
  totalAmount       Decimal        @db.Decimal(10, 2)
  currency          String         @default("NPR")
  shippingAddressId String?
  billingAddressId  String?
  notes             String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  currencySymbol    String         @default("NPR")
  customerCountry   String?
  exchangeRate      Decimal?       @db.Decimal(10, 4)
  nprDiscountAmount Decimal?       @db.Decimal(10, 2)
  nprShippingAmount Decimal?       @db.Decimal(10, 2)
  nprSubtotal       Decimal?       @db.Decimal(10, 2)
  nprTaxAmount      Decimal?       @db.Decimal(10, 2)
  nprTotalAmount    Decimal?       @db.Decimal(10, 2)
  items             OrderItem[]
  billingAddress    Address?       @relation("OrderBillingAddress", fields: [billingAddressId], references: [id])
  shippingAddress   Address?       @relation("OrderShippingAddress", fields: [shippingAddressId], references: [id])
  user              User           @relation(fields: [userId], references: [id])

  @@map("orders")
}

model OrderItem {
  id             String   @id @default(cuid())
  orderId        String
  productId      String
  quantity       Int
  price          Decimal  @db.Decimal(10, 2)
  total          Decimal  @db.Decimal(10, 2)
  createdAt      DateTime @default(now())
  currency       String   @default("NPR")
  currencySymbol String   @default("NPR")
  nprPrice       Decimal? @db.Decimal(10, 2)
  nprTotal       Decimal? @db.Decimal(10, 2)
  order          Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product        Product  @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Review {
  id         String   @id @default(cuid())
  userId     String
  productId  String
  rating     Int
  title      String?
  comment    String?
  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("reviews")
}

model SystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_config")
}

model CurrencyRate {
  id        String   @id @default(cuid())
  country   String
  currency  String
  symbol    String
  rateToNPR Decimal  @db.Decimal(10, 4)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([country, currency])
  @@map("currency_rates")
}

model Unit {
  id        String   @id @default(cuid())
  type      UnitType
  name      String
  symbol    String?
  isDefault Boolean  @default(false)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([type, name])
  @@map("units")
}

model TopBanner {
  id        String   @id @default(cuid())
  title     String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("top_banners")
}

model MediaItem {
  id           String    @id @default(cuid())
  mediaType    MediaType
  mediaUrl     String
  internalLink String
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  linkTo       String

  @@map("media_items")
}

model Slider {
  id           String   @id @default(cuid())
  imageUrl     String
  internalLink String   @default("")
  isActive     Boolean  @default(true)
  order        Int      @default(1)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("sliders")
}

model ActivityLog {
  id          String       @id @default(cuid())
  type        ActivityType
  action      String
  description String
  entityId    String?
  entityType  String?
  metadata    Json?
  userId      String?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime     @default(now())

  @@map("activity_logs")
}

model ContactMessage {
  id         String          @id @default(cuid())
  name       String
  email      String
  phone      String?
  subject    String
  message    String
  status     MessageStatus   @default(UNREAD)
  priority   MessagePriority @default(NORMAL)
  metadata   Json?
  adminReply String?
  repliedBy  String?
  repliedAt  DateTime?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  @@map("contact_messages")
}

enum ActivityType {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  ORDER_CREATED
  ORDER_UPDATED
  ORDER_CANCELLED
  PRODUCT_CREATED
  PRODUCT_UPDATED
  PRODUCT_DELETED
  USER_REGISTERED
  USER_UPDATED
  PAYMENT_SUCCESS
  PAYMENT_FAILED
}

enum UserRole {
  ADMIN
  CUSTOMER
  VENDOR
}

enum AddressType {
  SHIPPING
  BILLING
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum ShippingStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  RETURNED
}

enum UnitType {
  WEIGHT
  LENGTH
  CLOTHING_SIZE
  VOLUME
  TEMPERATURE
}

enum ProductVisibility {
  VISIBLE
  HIDDEN
  CATALOG_ONLY
  SEARCH_ONLY
}

enum AttributeType {
  TEXT
  NUMBER
  BOOLEAN
  COLOR
  IMAGE
  SELECT
  MULTI_SELECT
}

enum MediaType {
  IMAGE
  VIDEO
}

enum MessageStatus {
  UNREAD
  READ
  REPLIED
  ARCHIVED
}

enum MessagePriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum ContactStatus {
  PENDING
  READ
  RESPONDED
  CLOSED
}
